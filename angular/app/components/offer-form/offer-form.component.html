<div  style="padding:.5em;" layout="row" layout-align="space-between center" ng-if="vm.cms">
  <span class="md-title">{{ vm.offer.title || 'Neues Angebot'}}</span>
  <span>
    <md-input-container class="md-block">
      <label>NGO</label>
      <md-select ng-model="vm.offer.ngo_id" >
        <md-option ng-repeat="ngo in vm.ngos" ng-value="ngo.id">{{ ngo.organisation }}</md-option>
      </md-select>
    </md-input-container>
  </span>
</div>
<form name="offerForm" ng-submit="vm.save()" ng-invalid class="blank">
    <md-content class="blank" layout-xs="column" layout="row">
      <div flex-xs flex-gt-md="66"  flex-gt-xs="60" layout="column">
          <md-card>
            <md-card-title>
                <md-card-title-text>
                    <span class="md-headline">Details</span>
                </md-card-title-text>
            </md-card-title>
              <md-content layout-padding>
                  <md-input-container class="md-block">
                      <label>Titel</label>
                      <input ng-model="vm.offer.title" md-maxlength="200" required>
                  </md-input-container>
                  <md-input-container class="md-block">
                      <label>Beschreibung</label>
                      <textarea ng-model="vm.offer.description" md-maxlength="200" rows="3" required></textarea>
                  </md-input-container>

                  <md-input-container class="md-block">
                      <label>Email</label>
                      <input ng-model="vm.offer.email" type="email" placeholder="email@offer.com">
                  </md-input-container>
                  <md-input-container class="md-block">
                      <label>Telefonnummer</label>
                      <input ng-model="vm.offer.phone" ng-pattern="/^((\+\d{1,3}(-| )?\(?\d\)?(-| )?\d{1,5})|(\(?\d{2,6}\)?))(-| )?(\d{3,4})(-| )?(\d{4})(( x| ext)\d{1,5}){0,1}$/" placeholder="+43 660 12345678">
                  </md-input-container>
                  <md-input-container class="md-block">
                      <label>Webseite</label>
                      <input ng-model="vm.offer.website" type="url" placeholder="http://www.your-offer.com">
                  </md-input-container>
                  <md-input-container class="md-block">
                      <label>Öffnungszeiten</label>
                      <textarea ng-model="vm.offer.opening_hours" md-maxlength="200" rows="5"></textarea>
                  </md-input-container>
              </md-content>
          </md-card>
          <div layout="row" layout-xs="column" flex>
          <div flex-gt-xs="50" layout="column">
          <md-card >
            <md-card-title>
                <md-card-title-text>
                    <span class="md-headline">Filter</span>
                      <span class="md-subhead">{{ vm.offer.filters.length }} ausgewählt</span>
                </md-card-title-text>
            </md-card-title>
              <md-content layout-padding>
                  <filter-selector ng-model="vm.offer.filters"></filter-selector>
              </md-content>
            </md-card>
          </div>
          <div flex-gt-xs="50" layout="column">
            <md-card>
              <md-card-title>
                  <md-card-title-text>
                      <span class="md-headline">Kategorien</span>
                      <span class="md-subhead">{{ vm.offer.categories.length }} ausgewählt</span>
                  </md-card-title-text>
              </md-card-title>
              <treeview items="vm.categories"  selection="vm.offer.categories" options="vm.categoriesOptions"></treeview>
            </md-card>
          </div>
        </div>
      </div>
      <div flex-xs flex-gt-md="33" flex-gt-xs="40" layout="column">
            <md-card>
              <image-uploader ng-model="vm.offer" label="Logo oder Bild hochladen"></image-uploader>
            </md-card>
            <md-card>
                <md-card-title>
                    <md-card-title-text>
                        <span class="md-headline">Angebot gültig </span>
                    </md-card-title-text>
                </md-card-title>
                <md-content layout-padding layout="column" layout-align="space-between center">
                    <span>von
                        <md-datepicker ng-model="vm.valid_from" md-placeholder="Enter date"></md-datepicker>
                    </span>
                    <span>
                        bis
                        <md-datepicker ng-model="vm.valid_until" md-min-date="vm.valid_from" md-placeholder="Enter date"></md-datepicker>
                    </span>
                </md-content>
            </md-card>
            <md-card>
                <md-card-title>
                    <md-card-title-text>
                        <span class="md-headline">Adresse</span>
                    </md-card-title-text>
                </md-card-title>
                <md-content layout-padding>
                    <md-autocomplete ng-init="vm.offer.street=''" md-selected-item="vm.selectedItem" md-selected-item-change="vm.selectedItemChange(item)" md-search-text="vm.searchText" md-items="item in vm.querySearch(vm.searchText)" md-item-text="item.street+' '+item.number+', '+item.zip+' '+item.city"
                      md-min-length="2" md-floating-label="Adress-Suche" placeholder="z.B. Stephansplatz 1, 1010 Wien">
                        <md-item-template>
                            <span md-highlight-text="vm.searchText">{{item.street+' '+item.number+', '+item.zip+' '+item.city}}</span>
                        </md-item-template>
                        <md-not-found>
                            Keine passende Adresse gefunden!
                        </md-not-found>
                    </md-autocomplete>

                    <p ng-if="vm.offer.street">
                        {{vm.offer.street}} {{vm.offer.streetnumber}}
                        <br/> {{vm.offer.zip}} {{vm.offer.city}}
                        <br/>
                    </p>

                    <md-input-container class="md-block">
                        <label>Adresszusatz</label>
                        <input ng-model="vm.offer.streetnumberadditional">
                    </md-input-container>
                </md-content>
            </md-card>
          <div layout="row" layout-xs="column" flex>
              <div flex-gt-xs="100" layout="column">
                  <md-card>
                      <md-card-title>
                          <md-card-title-text>
                              <span class="md-headline">Übersetzungen</span>
                              <span class="md-subhead">{{ vm.offer.translations.length-1 }} vorhanden</span>
                          </md-card-title-text>
                      </md-card-title>
                      <md-table-container>
                          <table md-table>
                              <tbody md-body>
                              <tr ng-repeat="trans in vm.offer.translations" ng-if="trans.locale != 'de'">
                                  <td class="md-cell">{{trans.title}}</td>
                                  <td class="md-cell">{{trans.locale}}</td>
                                  <td md-cell>
                                      <md-button ng-click="vm.showTranslation()" class="md-icon-button">
                                          <md-icon>edit</md-icon>
                                      </md-button>
                                  </td>
                              </tr>
                              </tbody>
                          </table>
                      </md-table-container>
                  </md-card>
              </div>
          </div>
        </div>
    </md-content>
    <div flex layout="row" layout-align="end center">

    <md-button type="submit" class="md-primary md-raised" ng-disabled="offerForm.$invalid || Form.$pristine">Speichern</md-button>
    <md-button class="md-primary" ng-click="vm.cancel()">Abbrechen</md-button>
</div>
</form>
